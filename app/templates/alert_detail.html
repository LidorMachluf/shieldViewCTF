{% extends "base.html" %}

{% block title %}Alert #{{ alert.id }} â€” ShieldView SOC{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Alert #{{ alert.id }}</h1>
    <a href="{{ url_for('alerts.dashboard') }}" class="btn btn-secondary">&larr; Back to Dashboard</a>
</div>

<div class="page-content">
    <div class="breadcrumb">
        <a href="{{ url_for('alerts.dashboard') }}">Dashboard</a>
        <span class="sep">/</span>
        <span>Alert #{{ alert.id }}</span>
    </div>

    <!-- Alert header card with severity accent -->
    <div class="card alert-hero mb-4" style="border-left: 4px solid var(--severity-{{ alert.severity | lower }});">
        <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 18px;">
            <div class="alert-severity-icon" style="flex-shrink:0; width: 44px; height: 44px; border-radius: 10px; background: var(--severity-{{ alert.severity | lower }}-bg); display: flex; align-items: center; justify-content: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--severity-{{ alert.severity | lower }})" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    {% if alert.severity == 'HIGH' %}
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                    {% elif alert.severity == 'MEDIUM' %}
                    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                    {% else %}
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                    {% endif %}
                </svg>
            </div>
            <div style="flex: 1; min-width: 0;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
                    <span class="badge badge-{{ alert.severity | lower }}">{{ alert.severity }}</span>
                    <span class="mono text-muted" style="font-size: 12px;">#{{ alert.id }}</span>
                </div>
                <h2 style="font-size: 19px; font-weight: 700; line-height: 1.3;">{{ alert.title }}</h2>
            </div>
        </div>

        <p style="color: var(--text-secondary); margin-bottom: 24px; line-height: 1.7; font-size: 14px;">{{ alert.description }}</p>

        <div class="alert-detail-grid">
            <div class="detail-item">
                <div class="detail-label">Asset Hostname</div>
                <div class="detail-value mono">{{ alert.asset_hostname }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Asset IP</div>
                <div class="detail-value mono">{{ alert.asset_ip }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Source IP</div>
                <div class="detail-value mono">{{ alert.source_ip }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Timestamp</div>
                <div class="detail-value mono">{{ alert.created_at }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Alert ID</div>
                <div class="detail-value mono">#{{ alert.id }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Assigned To</div>
                <div class="detail-value">{{ alert.assigned_email or 'Unassigned' }}</div>
            </div>
        </div>
    </div>

    {% if alert.raw_log %}
    <div class="card">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px;">
            <h3 style="font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
                Raw Event Log
            </h3>
            <button class="btn btn-ghost" id="raw-log-toggle" onclick="toggleRawLog()" style="font-size: 12px;">Hide</button>
        </div>
        <div class="raw-log" id="raw-log-content">{{ alert.raw_log }}</div>
    </div>
    {% endif %}
</div>
{% endblock %}
